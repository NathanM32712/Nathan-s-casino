<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Roulette Simulator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#071018; --card:#0f1f2a; --accent:#00aaff; --muted:#9bd6ff; --text:#e6faff;
      --green:#2ecc71; --red:#ff5a5a; --black:#111;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Segoe UI,Roboto,system-ui}
    .wrap{max-width:920px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .backBtn{background:linear-gradient(180deg,#444,#222);color:var(--text);padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700}
    h1{color:var(--accent);margin:0;text-align:center;flex:1}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
    label{display:block;color:var(--muted);font-weight:600;margin-top:10px}
    input[type=number], select, input[type=text]{
      width:100%;padding:8px;border-radius:8px;border:none;background:#06131b;color:var(--text);
      box-sizing:border-box;margin-top:6px;
    }
    .btn{display:inline-block;margin-top:12px;padding:10px 14px;border-radius:8px;border:none;background:linear-gradient(180deg,var(--accent),#0088cc);color:#001;font-weight:700;cursor:pointer}
    .btn.secondary{background:linear-gradient(180deg,#444,#222);color:var(--text)}
    .result{margin-top:12px;padding:12px;border-radius:8px;background:#06131b;font-family:monospace}
    .balance{font-weight:800;color:var(--muted);font-size:18px}
    .wheel{display:flex;flex-direction:column;gap:12px}
    .spinDisplay{display:flex;align-items:center;gap:12px}
    .numberBox{width:84px;height:84px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:800}
    .log{margin-top:12px;background:#06131b;padding:10px;border-radius:8px;font-family:monospace;white-space:pre-wrap}
    .note{margin-top:8px;color:var(--muted);font-size:13px}
    .debug{margin-top:8px;color:#ffcc66;font-size:13px}
    @media (max-width:820px){ .grid{grid-template-columns:1fr; } .numberBox{width:64px;height:64px;font-size:22px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="backBtn" href="home.html" aria-label="Go to home">← Home</a>
      <h1>Roulette Simulator</h1>
      <div style="width:84px"></div>
    </header>

    <div class="grid">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Balance</strong><div class="balance" id="balance">$0.00</div></div>
          <div style="text-align:right;color:var(--muted)">European wheel 0–36</div>
        </div>

        <label>Bet Amount</label>
        <input type="number" id="betAmount" min="0.01" step="0.01" value="10">

        <label>Bet Type</label>
        <select id="betType" onchange="updateBetValueInput()">
          <option value="number">Single Number</option>
          <option value="color">Color</option>
          <option value="parity">Odd / Even</option>
          <option value="range">Low / High</option>
          <option value="dozen">Dozen</option>
          <option value="column">Column</option>
        </select>

        <div id="betValueContainer"></div>

        <div style="margin-top:12px">
          <button class="btn" id="placeBtn" onclick="placeBet()">Place Bet</button>
          <button class="btn secondary" onclick="clearBet()">Clear</button>
        </div>

        <div class="result" id="betSummary">No bet placed</div>
        <div class="note">Balance is read from cookie <strong>slotsbalance</strong> and will not be refilled automatically.</div>
        <div class="debug" id="cookieDebug"></div>
      </div>

      <div class="card wheel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Wheel</strong></div>
          <div>
            <button class="btn" id="spinBtn" onclick="spin()" disabled>Spin</button>
          </div>
        </div>

        <div class="spinDisplay">
          <div class="numberBox" id="spinNumber" style="background:#06131b;color:var(--muted)">—</div>
          <div style="flex:1">
            <div style="color:var(--muted)">Result</div>
            <div id="spinResult" style="font-weight:800;margin-top:6px">No spin yet</div>
            <div id="payoutInfo" style="margin-top:8px;color:var(--muted)"></div>
          </div>
        </div>

        <div class="log" id="history">History:\n</div>
      </div>
    </div>
  </div>

  <script>
    // Robust cookie helpers
    function getCookie(name){
      const cookies = document.cookie ? document.cookie.split(';') : [];
      for(let c of cookies){
        const idx = c.indexOf('=');
        if(idx === -1) continue;
        const k = c.slice(0, idx).trim();
        let v = c.slice(idx + 1);
        if(k === name) return decodeURIComponent(v.trim());
      }
      return null;
    }
    function setCookie(name, value, days){
      const d = new Date();
      d.setTime(d.getTime() + (days||365)*24*60*60*1000);
      document.cookie = `${name}=${encodeURIComponent(value)}; path=/; expires=${d.toUTCString()}`;
    }

    // Roulette config
    const redNumbers = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);

    // Read initial balance from cookie 'slotsbalance' robustly
    function parseBalanceRaw(raw){
      if(raw === null) return null;
      // strip currency symbols, commas, spaces; keep digits, dot, minus
      const cleaned = String(raw).replace(/[^0-9.\-]+/g, '');
      if(cleaned === '') return null;
      const v = parseFloat(cleaned);
      return isNaN(v) ? null : v;
    }

    function readInitialBalance(){
      const raw = getCookie('slotsbalance');
      console.log('document.cookie =', document.cookie);
      console.log('slotsbalance raw =', raw);
      const parsed = parseBalanceRaw(raw);
      return { raw, parsed };
    }

    // State
    let balanceState = readInitialBalance();
    let balance = (balanceState.parsed !== null) ? balanceState.parsed : 0.00;
    // Persist back to cookie so the cookie exists for future loads (will create non-HttpOnly cookie if none)
    setCookie('slotsbalance', balance.toFixed(2), 365);

    let currentBet = null;

    // UI refs
    const balanceEl = document.getElementById('balance');
    const betSummaryEl = document.getElementById('betSummary');
    const spinNumberEl = document.getElementById('spinNumber');
    const spinResultEl = document.getElementById('spinResult');
    const payoutInfoEl = document.getElementById('payoutInfo');
    const historyEl = document.getElementById('history');
    const spinBtn = document.getElementById('spinBtn');
    const placeBtn = document.getElementById('placeBtn');
    const betAmountInput = document.getElementById('betAmount');
    const cookieDebugEl = document.getElementById('cookieDebug');

    function formatMoney(n){ return '$' + n.toFixed(2); }

    function updateBalanceUI(){
      balanceEl.textContent = formatMoney(balance);
      const canBet = balance >= 0.01;
      placeBtn.disabled = !canBet;
      if(!canBet){
        betSummaryEl.textContent = 'Balance is zero; you cannot place bets.';
        spinBtn.disabled = true;
      }
      betAmountInput.max = Math.max(0.01, balance).toString();

      // Show cookie debug message for visibility
      if(balanceState.raw === null){
        cookieDebugEl.textContent = 'slotsbalance cookie not found or not readable by JavaScript (it may be HttpOnly or set on a different path/domain).';
      } else if(balanceState.parsed === null){
        cookieDebugEl.textContent = 'slotsbalance cookie found but value is invalid: "' + String(balanceState.raw) + '".';
      } else {
        cookieDebugEl.textContent = '';
      }
    }

    function updateBetValueInput(){
      const container = document.getElementById('betValueContainer');
      const type = document.getElementById('betType').value;
      container.innerHTML = '';
      if(type === 'number'){
        container.innerHTML = `<label>Number (0–36)</label><input type="number" id="betValue" min="0" max="36" step="1" value="14">`;
      } else if(type === 'color'){
        container.innerHTML = `<label>Color</label><select id="betValue"><option value="red">Red</option><option value="black">Black</option></select>`;
      } else if(type === 'parity'){
        container.innerHTML = `<label>Odd or Even</label><select id="betValue"><option value="odd">Odd</option><option value="even">Even</option></select>`;
      } else if(type === 'range'){
        container.innerHTML = `<label>Range</label><select id="betValue"><option value="low">1-18 (Low)</option><option value="high">19-36 (High)</option></select>`;
      } else if(type === 'dozen'){
        container.innerHTML = `<label>Dozen</label><select id="betValue"><option value="1">Dozen 1 (1-12)</option><option value="2">Dozen 2 (13-24)</option><option value="3">Dozen 3 (25-36)</option></select>`;
      } else if(type === 'column'){
        container.innerHTML = `<label>Column</label><select id="betValue"><option value="1">Column 1</option><option value="2">Column 2</option><option value="3">Column 3</option></select>`;
      }
    }

    function placeBet(){
      if(balance < 0.01){
        alert('Balance is zero; cannot place a bet.');
        return;
      }
      const amount = parseFloat(document.getElementById('betAmount').value);
      if(isNaN(amount) || amount <= 0){
        alert('Enter a valid bet amount.');
        return;
      }
      if(amount > balance + 0.0001){
        alert('Insufficient balance.');
        return;
      }
      const type = document.getElementById('betType').value;
      const valEl = document.getElementById('betValue');
      if(!valEl){
        alert('Select a bet value.');
        return;
      }
      const value = valEl.value;
      currentBet = { amount, type, value };
      betSummaryEl.textContent = `Bet placed: ${formatMoney(amount)} on ${type} = ${value}`;
      spinBtn.disabled = false;
    }

    function clearBet(){
      currentBet = null;
      betSummaryEl.textContent = 'No bet placed';
      spinBtn.disabled = true;
    }

    function spin(){
      if(!currentBet) return;
      // Deduct stake immediately and persist
      balance = Math.max(0, balance - currentBet.amount);
      setCookie('slotsbalance', balance.toFixed(2), 365);
      updateBalanceUI();

      // Spin result
      const n = Math.floor(Math.random() * 37); // 0..36
      const color = n === 0 ? 'green' : (redNumbers.has(n) ? 'red' : 'black');

      // Display
      spinNumberEl.textContent = n;
      spinNumberEl.style.background = color === 'red' ? 'var(--red)' : color === 'black' ? 'var(--black)' : 'var(--green)';
      spinNumberEl.style.color = '#fff';
      spinResultEl.textContent = `${n} — ${color.toUpperCase()}`;

      // Evaluate bet
      const payoutMultiplier = evaluateBet(currentBet, n, color); // profit multiplier (e.g., 35 for straight)
      const profit = currentBet.amount * payoutMultiplier;
      const totalReturn = currentBet.amount + profit;

      // Update balance with winnings and persist
      balance = Math.max(0, balance + totalReturn);
      setCookie('slotsbalance', balance.toFixed(2), 365);
      updateBalanceUI();

      // Show payout info
      if(payoutMultiplier > 0){
        payoutInfoEl.innerHTML = `<strong>Win!</strong> Profit: ${formatMoney(profit)} — Total return: ${formatMoney(totalReturn)}`;
      } else {
        payoutInfoEl.innerHTML = `<strong>Lose.</strong> You lost ${formatMoney(currentBet.amount)}.`;
      }

      // History
      const time = new Date().toLocaleTimeString();
      historyEl.textContent += `\n[${time}] Bet ${formatMoney(currentBet.amount)} on ${currentBet.type}=${currentBet.value} → Result ${n} ${color.toUpperCase()} → ${payoutMultiplier>0 ? 'WIN '+formatMoney(profit) : 'LOSS'}`;

      // Clear current bet
      currentBet = null;
      betSummaryEl.textContent = 'No bet placed';
      spinBtn.disabled = true;
    }

    // Returns profit multiplier (not including stake). Example: straight returns 35, even-money returns 1, loss returns 0.
    function evaluateBet(bet, number, color){
      const type = bet.type;
      const val = bet.value;

      if(type === 'number'){
        const target = parseInt(val,10);
        return (number === target) ? 35 : 0;
      }
      if(type === 'color'){
        if(number === 0) return 0;
        return (val === color) ? 1 : 0;
      }
      if(type === 'parity'){
        if(number === 0) return 0;
        const isEven = number % 2 === 0;
        return (val === 'even' && isEven) || (val === 'odd' && !isEven) ? 1 : 0;
      }
      if(type === 'range'){
        if(number === 0) return 0;
        if(val === 'low') return (number >=1 && number <=18) ? 1 : 0;
        return (number >=19 && number <=36) ? 1 : 0;
      }
      if(type === 'dozen'){
        if(number === 0) return 0;
        const d = parseInt(val,10);
        if(d === 1) return (number >=1 && number <=12) ? 2 : 0;
        if(d === 2) return (number >=13 && number <=24) ? 2 : 0;
        return (number >=25 && number <=36) ? 2 : 0;
      }
      if(type === 'column'){
        if(number === 0) return 0;
        const col = parseInt(val,10);
        const mod = number % 3;
        if(col === 1) return (mod === 1) ? 2 : 0;
        if(col === 2) return (mod === 2) ? 2 : 0;
        return (mod === 0) ? 2 : 0;
      }
      return 0;
    }

    // Initialize UI
    updateBetValueInput();
    updateBalanceUI();
  </script>
</body>
</html>